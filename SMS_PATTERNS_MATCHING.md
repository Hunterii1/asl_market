# الگوهای SMS برای سیستم Matching - ippanel

این فایل شامل تمام الگوهای SMS است که باید در پنل ippanel ثبت شوند.

## 1. SMS برای ویزیتور - درخواست Matching جدید

**زمان ارسال:** وقتی تأمین‌کننده درخواست Matching جدید ایجاد می‌کند و با ویزیتورها match می‌شود

**مکان در کد:** `backend/services/matching_service.go` - تابع `SendMatchingNotifications`

**متن فعلی:**
```
درخواست جدید برای فروش {product_name} در {destination_countries}. مبلغ: {price} {currency}. برای مشاهده جزئیات وارد اپلیکیشن شوید.
```

**الگوی پیشنهادی برای ippanel:**
```
درخواست جدید برای فروش {product_name} در {destination_countries}. مبلغ: {price} {currency}. برای مشاهده جزئیات وارد اپلیکیشن شوید.

ASL Market
```

**متغیرهای Pattern:**
- `product_name`: نام محصول (مثال: زعفران)
- `destination_countries`: کشورهای مقصد (مثال: امارات، عمان)
- `price`: قیمت (مثال: 1000)
- `currency`: واحد پول (مثال: دلار)

**مثال پیام کامل:**
```
درخواست جدید برای فروش زعفران در امارات، عمان. مبلغ: 1000 دلار. برای مشاهده جزئیات وارد اپلیکیشن شوید.

ASL Market
```

---

## 2. SMS برای تأمین‌کننده - درخواست پذیرفته شد

**زمان ارسال:** وقتی ویزیتور درخواست Matching را می‌پذیرد

**مکان در کد:** `backend/controllers/matching_controller.go` - تابع `RespondToMatchingRequest` (خط 686-701)

**وضعیت فعلی:** در حال حاضر فقط notification درون‌برنامه‌ای فرستاده می‌شود، SMS فرستاده نمی‌شود.

**متن پیشنهادی برای SMS:**
```
سلام

ویزیتور {visitor_name} درخواست شما برای فروش {product_name} را پذیرفته است.

می‌توانید از طریق چت در اپلیکیشن با ویزیتور ارتباط برقرار کنید.

ASL Market
```

**الگوی پیشنهادی برای ippanel:**
```
سلام

ویزیتور {visitor_name} درخواست شما برای فروش {product_name} را پذیرفته است.

می‌توانید از طریق چت در اپلیکیشن با ویزیتور ارتباط برقرار کنید.

ASL Market
```

**متغیرهای Pattern:**
- `visitor_name`: نام ویزیتور (مثال: محمد احمدی)
- `product_name`: نام محصول (مثال: زعفران)

**مثال پیام کامل:**
```
سلام

ویزیتور محمد احمدی درخواست شما برای فروش زعفران را پذیرفته است.

می‌توانید از طریق چت در اپلیکیشن با ویزیتور ارتباط برقرار کنید.

ASL Market
```

---

## 3. SMS برای ویزیتور - تأیید پذیرش درخواست

**زمان ارسال:** وقتی ویزیتور درخواست را می‌پذیرد (اختیاری - برای تأیید)

**وضعیت فعلی:** در حال حاضر این SMS فرستاده نمی‌شود.

**متن پیشنهادی برای SMS:**
```
سلام

درخواست شما برای {product_name} از تأمین‌کننده {supplier_name} با موفقیت ثبت شد.

می‌توانید از طریق چت در اپلیکیشن با تأمین‌کننده ارتباط برقرار کنید.

ASL Market
```

**الگوی پیشنهادی برای ippanel:**
```
سلام

درخواست شما برای {product_name} از تأمین‌کننده {supplier_name} با موفقیت ثبت شد.

می‌توانید از طریق چت در اپلیکیشن با تأمین‌کننده ارتباط برقرار کنید.

ASL Market
```

**متغیرهای Pattern:**
- `product_name`: نام محصول (مثال: زعفران)
- `supplier_name`: نام تأمین‌کننده (مثال: شرکت زعفران طلایی)

**مثال پیام کامل:**
```
سلام

درخواست شما برای زعفران از تأمین‌کننده شرکت زعفران طلایی با موفقیت ثبت شد.

می‌توانید از طریق چت در اپلیکیشن با تأمین‌کننده ارتباط برقرار کنید.

ASL Market
```

---

## خلاصه Pattern های مورد نیاز

### Pattern 1: درخواست Matching جدید برای ویزیتور
- **کد Pattern:** (باید در ippanel ثبت شود)
- **متغیرها:** `product_name`, `destination_countries`, `price`, `currency`
- **وضعیت:** ✅ در حال استفاده (اما `SendSimpleSMS` باید به pattern تبدیل شود)

### Pattern 2: درخواست پذیرفته شد برای تأمین‌کننده
- **کد Pattern:** (باید در ippanel ثبت شود)
- **متغیرها:** `visitor_name`, `product_name`
- **وضعیت:** ❌ هنوز پیاده‌سازی نشده (فقط notification درون‌برنامه‌ای)

### Pattern 3: تأیید پذیرش برای ویزیتور (اختیاری)
- **کد Pattern:** (باید در ippanel ثبت شود)
- **متغیرها:** `product_name`, `supplier_name`
- **وضعیت:** ❌ هنوز پیاده‌سازی نشده

---

## نکات مهم

1. **Pattern 1** در حال حاضر از `SendSimpleSMS` استفاده می‌کند که فقط log می‌کند. باید به `SendPattern` تبدیل شود.

2. **Pattern 2** باید در `RespondToMatchingRequest` اضافه شود تا وقتی ویزیتور درخواست را می‌پذیرد، SMS به تأمین‌کننده فرستاده شود.

3. **Pattern 3** اختیاری است و می‌تواند برای تأیید ویزیتور اضافه شود.

4. تمام SMS ها باید با "ASL Market" به پایان برسند.

5. قبل از ثبت pattern ها در ippanel، باید مطمئن شوید که:
   - متن pattern دقیقاً مطابق با الگوهای بالا باشد
   - متغیرها به درستی تعریف شده باشند
   - pattern تأیید شده باشد

---

## مراحل ثبت در ippanel

1. وارد پنل ippanel شوید
2. به بخش "الگوها" یا "Patterns" بروید
3. برای هر pattern:
   - روی "ایجاد الگوی جدید" کلیک کنید
   - متن pattern را وارد کنید
   - متغیرها را تعریف کنید
   - pattern را تأیید کنید
   - کد pattern را کپی کنید
4. کدهای pattern را در فایل `.env` یا تنظیمات backend اضافه کنید

---

## فایل‌های کد که باید تغییر کنند

1. `backend/services/matching_service.go` - خط 204-210: تبدیل `SendSimpleSMS` به `SendPattern`
2. `backend/controllers/matching_controller.go` - خط 686-701: اضافه کردن SMS برای تأمین‌کننده
3. `backend/services/sms_service.go` - اضافه کردن متد جدید برای matching notifications
4. فایل `.env` - اضافه کردن کدهای pattern جدید

